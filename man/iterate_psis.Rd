% Generated by roxygen2 (4.1.1): do not edit by hand
% Please edit documentation in R/research-advi-psis.R
\name{iterate_psis}
\alias{KLdivergence}
\alias{iter_control}
\alias{iterate_psis}
\title{Iterative Pareto smoothed importance sampling}
\usage{
iterate_psis(start, stanfit, control = iter_control(), ...)

iter_control(smooth_weights = TRUE, max_iter = 20, ndraws = 4000,
  verbose = TRUE, plot = interactive())

KLdivergence(mu_approx, Sigma_approx, mu_true, Sigma_true)
}
\arguments{
\item{start}{Named list with components \code{log_p} (target), \code{log_g}
(proposal), \code{draws} (parameter draws from approximate posterior).}

\item{stanfit}{\code{\link[=stanfit-class]{stanfit}} object from which to
obtain \code{log_prob()} and \code{unconstrain_pars()} functions.}

\item{control}{Parameters controlling the iterative process.}

\item{...}{Optional PSIS tuning parameters passed to \code{\link{psislw}}.}

\item{smooth_weights}{If \code{TRUE} (the default) \code{\link[psislw]{PSIS}}
is used to smooth the raw weights. If \code{FALSE} the raw weights are
used.}

\item{max_iter}{The maximum allowed number of iterations. The algorithm will
stop after \code{max_iter} iterations even if \eqn{k > 1/2}.}

\item{ndraws}{The size of the multivariate normal sample to generate at each
iteration.}

\item{verbose}{Should status updates be printed?}

\item{plot}{Should pareto k estimates be plotted as each iteration finishes?}

\item{mu_approx,Sigma_approx,mu_true,Sigma_true}{Mean and covariance matrices
  for approximating distribution and comparison (true) distribution. KL
  divergence is then computed using \code{\link[monomvn]{kl.norm}}.}
}
\value{
A named list with components
\itemize{
\item \code{mu} Mean vectors
\item \code{Sigma} Covariance matrices
\item \code{khat} Pareto shape estimates
\item \code{coef_lg} Slopes from regression of log_p on log_g
}
Each component is a list of length equal to the number of iterations.
}
\description{
Iterative importance weighting using Pareto Smoothed Importance Sampling  (PSIS).
The number of iterations is a random variable and is determined by the
shape parameter \eqn{k} of a generalized Pareto distribution. The algorithm
stops once \eqn{k < 1/2} (see Details).
}
\details{
We start by computing log weights from \code{start$log_p} and
\code{start$log_g}, smoothing them with PSIS, and computing the weighted mean
vector and covariance matrix using the smoothed weights and
\code{start$draws}. We then take this first weighted mean vector and
covariance matrix pair and use them to start the iterative process:

\enumerate{
\item Draw from multivariate normal approximation.
\item Evaluate log_p and log_g.
\item Apply PSIS to smooth log weights (if \code{smooth_weights} = TRUE).
\item Calculate weighted mean vector and covariance matrix.
}

\subsection{Stopping rule}{
The iterative algorithm will stop once the estimate of the Pareto shape
parameter \eqn{k} (estimated during PSIS smoothing) is below \eqn{1/2} or
when \code{max_iter} is reached.

\itemize{
\item If \eqn{k < 1/2} the variance of the raw importance ratios is finite,
 the central limit theorem holds, and the estimate converges quickly.
\item If \eqn{k} is between \eqn{1/2} and \eqn{1} the variance of the raw importance
 ratios is infinite but the mean exists, the generalized central limit theorem
 for stable distributions holds, and the convergence of the estimate is
 slower. The variance of the PSIS estimate is finite but may be large.
\item If \eqn{k > 1} the variance and the mean of the raw ratios distribution
 do not exist. The variance of the PSIS estimate is finite but may be large.
}
}
}

